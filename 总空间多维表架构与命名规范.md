# 总空间多维表架构与命名规范

### 1. 根空间治理原则 (Root Space Governance)

为防止根目录熵增与数据孤岛，根空间的创建需遵循严格的 **“单一数据源”** 原则。

- **严格准入机制：** 禁止在总空间根目录下创建任何非「部门总表」或「全局引用表」以外的临时表、测试表。
- **部门单例模式：** 每个部门原则上仅允许存在一张总表（Master Table），作为该部门数据的唯一入口。
- **命名格式：** `部门-部门名称`
- **示例：** 支持部表格应命名为 `部门-支持部`。
- **命名锁定：** 部门总表一经创建，禁止随意重命名，以防止依赖该表名的自动化流（API/Webhook）失效。
- **全局引用表（Global References）：**
- **定义：** 凡涉及跨部门、高频调用的基础数据（如人员档案、SKU列表、组织架构），必须建立独立的引用表。
- **命名格式：** `引用-引用数据类型`
- **示例：** 全员花名册应命名为 `引用-员工管理`。
- **约束：** 引用表的Schema（字段结构）变更需经过评估，禁止随意增删核心字段，以免破坏下游表的引用关系。

---

### 2. 数据实体命名规范 (Data Entity Naming)

多维表内的子表（Sub-tables）承载具体的业务数据，命名需体现数据的**功能属性**。

- **命名格式：** `数据表_业务功能`
- **规范详解：**
- 前缀 `数据表_` 标识该对象为静态存储实体。
- 后缀 `业务功能` 需简洁明确，避免歧义。

- **实战示例（支持部）：**
- 用于记录绩效打分的数据：`数据表_绩效考核`
- 用于统计提交情况的数据：`数据表_交表统计`

---

### 3. 自动化工作流命名规范 (Workflow Naming)

工作流（Automation）的命名必须清晰描述其**动作（Action）**与**数据流向（Data Flow）**，以便于在复杂的后台日志中快速定位。

- **格式 A（单点处理）：** `工作流_动作_目标对象`
- 适用于自处理逻辑，如计算、状态变更。
- **示例：** 自动计算绩效扣分 -> `工作流_计算_绩效考核`

- **格式 B（数据流转）：** `工作流_动作_来源对象>目标对象`
- 适用于跨表数据同步、ETL过程。
- **示例：** 从统计表同步数据至考核表 -> `工作流_同步_交表统计>绩效考核`

> **Note:** 动作动词建议统一使用标准术语，如：`同步`、`计算`、`推送`、`归档`、`清洗`。

---

### 4. 目录结构与封装规范 (Directory Structure)

为保证工程结构的“高内聚”，相关的业务数据与逻辑必须进行物理层面的**封装**。

- **封装原则：** 当一组子表与工作流共同服务于同一业务方向时，必须建立专属子文件夹进行收纳，严禁散落在根目录。
- **目录命名：** `目录_业务模块`
- **内部排序规范（Visual Hierarchy）：**

1. **Top:** 数据实体（`数据表_xxx`） —— _作为核心资产置顶_
2. **Bottom:** 业务逻辑（`工作流_xxx`） —— _作为服务设施置底_

| 排序 | 类型     | 命名示例                          | 说明     |
| ---- | -------- | --------------------------------- | -------- |
| 1    | F 文件夹 | `目录_月度绩效`                   | 业务容器 |
| 2    | D 数据表 | └ `数据表_绩效考核`               | 核心数据 |
| 3    | D 数据表 | └ `数据表_交表统计`               | 辅助数据 |
| 4    | A 工作流 | └ `工作流_同步_交表统计>绩效考核` | 业务逻辑 |

---

### 5. 工程文档与维护规范 (Engineering Documentation)

为了确保系统的逻辑对新加入的协作者透明，避免“黑盒”运行，必须建立完善的文档机制。

- **根级 README 机制：**
- **触发条件：** 若部门多维表中包含**任意**自动化流程（无论简单与否）。
- **执行规范：** 必须在多维表根目录创建一张独立文档表（或使用仪表盘文本组件），命名为 `README`。
- **内容要求：** 必须包含该多维表的“系统运行全景图”或文字说明，阐述数据如何流转。

- **模块级说明文档：**
- **触发条件：** 当某一子文件夹（`目录_xxx`）内的子表众多、工作流逻辑繁琐复杂时。
- **执行规范：** 需在该子文件夹内创建说明文档。
- **命名格式：** `文档_运行逻辑说明` 或 `README_模块名`。
- **内容要求：** 简要说明该模块的输入（Input）、处理逻辑（Process）与输出（Output）。

---

### 6. 数据引用拓扑规范 (Reference Topology)

为防止产生长链路依赖导致的性能损耗与“牵一发而动全身”的维护风险，严格限制引用关系为**扁平化星型拓扑**。

- **单一指向原则 (Single Point of Truth Policy)：**
- 数据引用必须直接指向源头（引用表），严禁通过中间表进行二次传递。

- **拓扑图示：**
- ✅ **允许（扁平结构）：**
- `引用-A内子表` -> `数据表_B` （B直接引用A）
- `引用-A内子表` -> `数据表_C` （C直接引用A）

- 🚫 **禁止（链式结构）：**
- `引用-A内子表` -> `数据表_B` -> `数据表_C`
- _(解释：严禁 C 引用 B 中的“引用A字段”。若 C 需要 A 的数据，必须直接建立 C 到 A 的引用关系)_

- **技术红线：**
- 禁止创建“套娃式”Lookup（查找引用），即禁止在 B 表中 Lookup A 表数据后，C 表又去 Lookup B 表中的该字段。此行为将导致数据更新延迟极高且难以排查错误。

---

### 7. 跨部门连接与同步规范 (Cross-Department Sync)

允许使用连接器（Connector）将其他部门的数据接入本部门，但必须严格控制数据链路的深度。

- **命名格式：** `同步表_外部数据源名称`
- **示例：** 支持部需要查看财务部的打款记录，应建立 `同步表_财务打款记录`。

- **拓扑约束（禁止级联）：**
- 必须遵循 **“源头直连”** 原则。即：只能连接 “原始数据表”，严禁连接“别人的同步表”。
- ✅ **允许：**
- `财务部（原始表）` -> 蒙牛部（`同步表_财务`）
- `财务部（原始表）` -> 支持部（`同步表_财务`）
- 🚫 **禁止：**
- `财务部（原始表）` -> 蒙牛部（`同步表_财务`） -> 支持部（`同步表_行政_财务`）
- _原因：级联同步会导致数据延迟指数级叠加，且一旦中间环节断裂，下游将全部瘫痪。_

---

### 8. 权限界定与安全 (Access Control)

- **最小权限原则 (Least Privilege)：**
- 默认情况下，仅授予用户完成工作所需的**最低级别权限**。
- **只读 (Read-Only)：** 适用于需要查看报表但无权修改数据的用户。
- **编辑 (Editor)：** 仅限该业务模块的直接负责人。
- **管理 (Admin)：** 严控管理员数量，防止结构被误删改。

- **引用表保护：** `引用表_` 系列通常由系统管理员维护，普通用户原则上仅拥有“仅查看”权限，禁止开放“可编辑”权限给非维护人员。

---

### 9. 应用模式与看板发布规范 (App Mode & Dashboard)

应用模式是部门对外展示信息的**唯一官方窗口**。为保证数据安全与展示的专业性，必须遵循**“前后台分离”**原则。

- **应用单例限制：**
- 允许在根空间创建应用，但每个部门仅限创建一个主应用。
- **命名格式：** `应用_部门名称` （例：`应用_支持部门户`）。

- **内部结构命名：**
- **子面板（页面）：** 必须遵循子表命名逻辑，体现业务功能。
- **格式：** `页面_业务功能` （例：`页面_绩效公示`、`页面_交表概览`）。

- **子文件夹（导航组）：** 必须遵循目录命名逻辑。
- **格式：** `目录_业务模块` （例：`目录_月度考核`）。

- **前后台物理隔离 (Frontend/Backend Isolation)：**
- **多维表本体（后端）：** 遵循**最小化原则**，非必要不外显。对于仅需查看信息的人员（Viewer），**严禁**直接授予多维表本体的阅读权限。
- **权限黑盒化：** 纯查看人员的权限必须设置为“不可读、不可写”。
- **访问路径：** 查看人员**只能**通过“应用模式看板”的链接访问数据，确保其无法接触到底层数据结构与辅助字段。

---

### 10. 视图治理规范 (View Governance)

_原因：多人协作时，公共视图常被误加筛选条件导致其他人看数据出错；或者产生大量 `副本*视图1` 的垃圾视图。_

- **公共视图锁定原则 (Public View Lock)：**
- 被标记为**公共视图**（如：默认表格视图、看板视图）严禁个人随意修改筛选与排序条件。
- **命名格式：** `公共_视图名称`
- **示例：** `公共_全员看板`、`公共_未处理工单`

- **临时/个人视图隔离：**
- 若用户需要进行个性化的筛选查看，**必须**复制出一个新的视图，并以“个人”为前缀。
- **命名格式：** `个人_姓名_视图用途`
- **示例：** `个人_张三_本周筛选`

- **定期清理机制：**
- 管理员有权在不通知的情况下，定期清理所有非 `公共_` 开头的、且超过30天未访问的个人视图。

---

### 11. 字段管理与卫生规范 (Field Hygiene)

_原因：存在大量“中间计算字段”混在业务字段中，导致表格臃肿；或字段类型定义随意（如用文本存日期）。_

- **索引列字段命名原则 (PrimaryKey Fields)：**
- 索引列强制设定类型为自动编号且为自增数字，严格禁止设置为任何其他类型
- **命名格式：** 强制统一命名为 `索引`，严格禁止设置为其他名称。
  > **Note：** 无论任何数据表，索引列都必须统一为`自动编号类型`，且字段命名都必须统一为`索引`。
- **辅助字段隐形原则 (Ghost Fields)：**
- 凡是仅用于中间计算、辅助查找、格式转换的字段，**必须**在前端视图中隐藏。
- **命名格式：** `(辅助)_字段名` 或 `_calc_字段名`（利用特殊字符使其排序沉底）。
- **示例：** 用于辅助拼接姓名的字段应命名为 `(辅助)_全名拼接`。

- **强类型约束 (Strict Typing)：**
- **严禁**使用“单行文本”字段存储日期、数字或枚举选项。
- 凡是选项固定的内容（如：状态、部门、优先级），**必须**使用“单选/多选”字段，禁止手输，以防止因错别字导致的数据统计失效。

- **废弃字段标识：**
- 不再使用的字段，若因历史数据原因不能删除，必须重命名为 `(废弃)_原字段名` 并隐藏，严禁直接留在那误导新人。

---

### 12. 视觉与状态语义规范 (Visual Semantics)

_原因：A表里“绿色”代表“进行中”，B表里“绿色”代表“已完成”，导致跨部门协作认知错乱。_

- **状态色谱统一标准 (Global Color Code)：**
- 全空间内的所有多维表，状态颜色必须遵循统一的语义标准，禁止由个人喜好定义。
- 🔴 **红色系：** 必须用于负向状态（如：驳回、错误、延期、高风险）。
- 🟡 **黄色/橙色系：** 必须用于进行中/等待状态（如：进行中、审批中、待处理）。
- 🟢 **绿色系：** 必须用于正向/终态（如：已完成、通过、正常）。
- ⚪ **灰色系：** 必须用于静默/无效状态（如：草稿、已取消、未开始）。

---

### 13. 仪表盘发布规范 (Dashboard Release)

_原因：方便数据异常时，能迅速找到是哪张表出了问题，而不是去猜。_

- **单一信源展示：**
- 仪表盘内展示的数据统计图，必须在其标题或说明中备注**数据来源表**的名称。
